---
title: "Project Outline"
author: "Veena Advani"
date: "4/18/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library("foreign")
library("dplyr")
library("tidyr")
library("countrycode")
library("rworldmap")
library(ggplot2)
library(reshape2)
library(FNN)
```

### Changes to Dataset from Last time
```{r}
#To start, let's read in the cleaned dataset from our last submission:
teacher_data <- read.csv("TALIS.csv", as.is=TRUE)
subject_data <- read.csv("subject_data.csv", as.is=TRUE)

#change column names of 10 satisfaction questions to make more readable
indices <- grep("TT2G46", colnames(teacher_data))[-11]
colnames(teacher_data)[indices] <- c("sat1", "sat2", "sat3", "sat4", "sat5", "sat6", "sat7", "sat8", "sat9", "sat10")

#Column "TT2G15" contains no useful data, since it's all NAs, so we're going to remove it
teacher_data <- teacher_data[, -24]

#Column "ID" is no longer necessary, was used for making the subject dataset
teacher_data <- teacher_data[, -36]

#change some of the subject names (one of the comments in our dataset submission was that they weren't clear):
names(teacher_data)[names(teacher_data) == "For_Lang"] <- "Modern_Lang"
names(teacher_data)[names(teacher_data) == "Gk_Ln"] <- "Ancient_Lang"
```

#### Change to Plot 3

This plot is a cleaner version of what we were trying to show with our last plot (from when we turned in the dataset)
```{r}
data_melted <- melt(teacher_data[,grep("TT2G46", colnames(teacher_data))], id.vars="TT2G46_avg")
data_melted %>% ggplot(aes(x=variable, y=value)) + geom_boxplot() + labs(x="Individual Questions", y="Strongly Disagree to Strongly Agree", title="Average Response vs Individual Questions for Satisfaction")
```


### Main Questions:
(1) Which variables and classroom factors are the best predictors of teacher job satisfaction?
(2) How do teacher satisfaction, as well as some of the significant predictors found from question 1, vary by country?
### Introduction

### Data
#### Initial Plots Describing Data

First, we look at a plot of age vs years teacher.
```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=gender)) + geom_point(alpha=0.5,shape=".") + geom_abline(intercept =0, slope=1) +  geom_jitter(alpha=0.5,shape=".")
```

Right away, we can see that there are a number of outliers who appear to have been teaching longer than they've been alive. These are the points above the black line, which represents y=x.

```{r}
teacher_data$age_start <- teacher_data$age - teacher_data$years_teacher
sum(na.omit(teacher_data$age_start) <= 0)
```

Although it doesn't really make sense for people to have started working as a teacher at age 5 either. Let's take a look at how many respondents said they started teaching before age 15 and 21. 
```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=gender)) + geom_point(alpha= 0.5, shape=".") + geom_abline(intercept = -15, slope=1) + geom_abline(intercept = -21, slope=1) 
```

```{r}
sum(na.omit(teacher_data$age_start) <= 15)
```

```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=country)) + geom_point(alpha= 0.5, shape=".") + geom_smooth(method="lm", se=F)
```

We can see that every

### Analysis
#### Linear Regression Analysis

Using stepwise regression
```{r}
# remove SAT questions, since they obviously explain our predictor variable, and then remove NAs for stepwise regression
x <- na.omit(teacher_data[, -grep("sat", colnames(teacher_data))])
m.full <- lm(TT2G46_avg ~., data=x)
m.empty <- lm(TT2G46_avg ~ 1, data=x)
```
Forward, backwards, and both
```{r}
m.forward <- step(m.empty, scope=list(upper=m.full),
                  data=x, direction="forward", trace=FALSE)
m.backward <- step(m.full, scope=list(lower=m.empty),
                  data=x, direction="backward", trace=FALSE)
m.both <- step(m.empty, scope=list(upper=m.full),
                  data=x, direction="both", trace=FALSE)
```



