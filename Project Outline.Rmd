---
title: "Project Outline"
author: "Veena Advani"
date: "4/18/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library("foreign")
library("dplyr")
library("tidyr")
library("countrycode")
library("rworldmap")
library(ggplot2)
library(reshape2)
library(FNN)
```

### Changes to Dataset from Last time
```{r}
#To start, let's read in the cleaned datasets from our last submission:
teacher_data <- read.csv("TALIS.csv")
subject_data <- read.csv("subject_data.csv", as.is=TRUE)

#change column names of 10 satisfaction questions to make more readable
indices <- grep("TT2G46", colnames(teacher_data))[-11]
colnames(teacher_data)[indices] <- c("sat1", "sat2", "sat3", "sat4", "sat5", "sat6", "sat7", "sat8", "sat9", "sat10")
names(teacher_data)[names(teacher_data)=="TT2G46_avg"] <- "sat_avg"

#Column "TT2G15" contains no useful data, since it's all NAs, so we're going to remove it
teacher_data <- teacher_data[, -24]

#Column "ID" is no longer necessary, was used for making the subject dataset
teacher_data <- teacher_data[, -36]

#change some of the subject names (one of the comments in our dataset submission was that they weren't clear):
names(teacher_data)[names(teacher_data) == "For_Lang"] <- "Modern_Lang"
names(teacher_data)[names(teacher_data) == "Gk_Ln"] <- "Ancient_Lang"
```

A lot of the variables stored as categorical variables with the categories "Strongly Disagree", "Disagree", "Strongly Agree", and "Agree", are currently factors.  Given that these categories do have a natural ordering, we're going to convert them into ordered factors.

```{r}
teacher_data$prep_A <- factor(teacher_data$prep_A, levels=c("Not at all", "Somewhat", "Well", "Very well"), ordered=TRUE)
teacher_data$prep_B <- factor(teacher_data$prep_B, levels=c("Not at all", "Somewhat", "Well", "Very well"), ordered=TRUE)
teacher_data$prep_C <- factor(teacher_data$prep_C, levels=c("Not at all", "Somewhat", "Well", "Very well"), ordered=TRUE)

teacher_data$feedback_salary <- factor(teacher_data$feedback_salary, levels=c("No positive change", "A small change", "A moderate change", "A large change"), ordered=TRUE)

teacher_data$collab <- factor(teacher_data$collab, levels=c("Strongly disagree", "Disagree", "Agree", "Strongly agree"), ordered=TRUE)
```

### Introduction
Introduction - No more than 1 page. Briefy describe the dataset you are studying and the research question you aim to answer. Provide ample motivation to convince your audience of the relevance of your research question.

This analysis will focus on the Teaching and Learning International Survey (TALIS) Dataset.
Some information about TALIS:
* It aimed to collect information on teaching profession, working conditions, and learning environments of schools
* One goal was to come up with metrics and information that would enable comparisons across countries
* It focused on lower secondary schools
* There are 36 countries in the dataset

SCED* Level 2 schools were selected. At selected schools, the principal (or head administrator) and a random selection of up to 22 teachers were chosen to complete voluntary online questionnaires. The countries include non-English speaking countries. The only requirement was that participating countries must be industrialized. All the variables we were studying were self reported. 

#### Main Research Questions:
(1) Which variables and classroom factors are the best predictors of teacher job satisfaction?
(2) How do teacher satisfaction, as well as some of the significant predictors found from question 1, vary by country?

#### Motivation of Study:
* Education is important to any country's basic development and functioning
* There is a fair amount of diversity across countries with regard to how well the teaching profession is respected.
* As a result, teacher working conditions vary quite a bit
* However, in order to make sure that there are enough teachers, and that they are able to teach their students well, it is important that teacher satisfaction is at a high enough level.  If teacher satisfaction is low, they are less likely to enjoy their jobs and put a lot of energy into their teaching, and there is a higher chance that they will leave their jobs and that less people will enter the teaching profession.
* Therefore, understanding how teacher satisfaction varies across the 36 countries in the data set, and which aspects of a school and environment correlate most with teacher satisfaction, could be helpful information in order to make sure that countries have enough teachers, and that teachers are able to do their jobs well.

### Data
#### Initial Plots Describing Data
##### Plot 1: Teacher Age vs Years of Teaching Experience
First, we look at a plot of age vs years teacher.
```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=gender)) + geom_point(alpha=0.5,shape=".") + geom_abline(intercept =0, slope=1) +  geom_jitter(alpha=0.5,shape=".")
```

Right away, we can see that there are a number of outliers who appear to have been teaching longer than they've been alive. These are the points above the black line, which represents y=x.

```{r}
teacher_data$age_start <- teacher_data$age - teacher_data$years_teacher
sum(na.omit(teacher_data$age_start) <= 0)
```

Although it doesn't really make sense for people to have started working as a teacher at age 5 either. Let's take a look at how many respondents said they started teaching before age 15 and 21. 
```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=gender)) + geom_point(alpha= 0.5, shape=".") + geom_abline(intercept = -15, slope=1) + geom_abline(intercept = -21, slope=1) 
```

```{r}
sum(na.omit(teacher_data$age_start) <= 15)
```

```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=country)) + geom_point(alpha= 0.5, shape=".") + geom_smooth(method="lm", se=F)
```

### Analysis
#### Linear Regression Analysis
```{r}
sat_indices <- grep("sat", names(teacher_data))[-12]
#some columns also have many more NA values, lets make a list of those so we can choose whether or not to include them in our linear models
na_indices <- c(10,11)
subject_indices <- c(24:35)
m1 <- lm(sat_avg ~ ., data=teacher_data[,-c(na_indices, sat_indices, subject_indices)])
summary(m1)
```

Using stepwise regression
```{r}
# remove SAT questions, since they obviously explain our predictor variable, and then remove NAs for stepwise regression
x <- na.omit(teacher_data[, -c(sat_indices, na_indices, subject_indices)])
m.full <- lm(sat_avg ~., data=x)
m.empty <- lm(sat_avg ~ 1, data=x)
```
Forward, backwards, and both
```{r}
m.forward <- step(m.empty, scope=list(upper=m.full),
                  data=x, direction="forward", trace=FALSE)
m.backward <- step(m.full, scope=list(lower=m.empty),
                  data=x, direction="backward", trace=FALSE)
m.both <- step(m.empty, scope=list(upper=m.full),
                  data=x, direction="both", trace=FALSE)
```


#### One-way Anova Tests
##### Does Feedback Influence Salary Increases?
```{r}
m2 <- lm(sat_avg ~ feedback_salary, data=teacher_data)
anova(m2)
boxplot(sat_avg ~ country, data=teacher_data)
teacher_data$subject_count <- rowSums(teacher_data[,24:35], na.rm=TRUE)
```

##### Total Time
```{r}
m3 <- lm(sat_avg ~ total_time, data=teacher_data)
anova(m3)
plot(teacher_data$sat_avg ~ teacher_data$total_time)
abline(m3)
```


