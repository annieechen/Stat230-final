---
title: "Project Outline"
author: "Veena Advani"
date: "4/18/2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, message=FALSE, warning=FALSE}
library("foreign")
library("dplyr")
library("tidyr")
library("countrycode")
library("rworldmap")
library(ggplot2)
library(reshape2)
library(FNN)
```

### Changes to Dataset from Last time
```{r}
#To start, let's read in the cleaned dataset from our last submission:
teacher_data <- read.csv("TALIS.csv")
subject_data <- read.csv("subject_data.csv", as.is=TRUE)

#change column names of 10 satisfaction questions to make more readable
indices <- grep("TT2G46", colnames(teacher_data))[-11]
colnames(teacher_data)[indices] <- c("sat1", "sat2", "sat3", "sat4", "sat5", "sat6", "sat7", "sat8", "sat9", "sat10")
names(teacher_data)[names(teacher_data)=="TT2G46_avg"] <- "sat_avg"

#Column "TT2G15" contains no useful data, since it's all NAs, so we're going to remove it
teacher_data <- teacher_data[, -24]

#Column "ID" is no longer necessary, was used for making the subject dataset
teacher_data <- teacher_data[, -36]

#change some of the subject names (one of the comments in our dataset submission was that they weren't clear):
names(teacher_data)[names(teacher_data) == "For_Lang"] <- "Modern_Lang"
names(teacher_data)[names(teacher_data) == "Gk_Ln"] <- "Ancient_Lang"
```

A lot of the variables stored as categorical variables with the categories "Strongly Disagree", "Disagree", "Strongly Agree", and "Agree", are currently factors.  Given that these categories do have a natural ordering, we're going to convert them into ordered factors.

```{r}
teacher_data$prep_A <- factor(teacher_data$prep_A, levels=c("Not at all", "Somewhat", "Well", "Very well"), ordered=TRUE)
teacher_data$prep_B <- factor(teacher_data$prep_B, levels=c("Not at all", "Somewhat", "Well", "Very well"), ordered=TRUE)
teacher_data$prep_C <- factor(teacher_data$prep_C, levels=c("Not at all", "Somewhat", "Well", "Very well"), ordered=TRUE)

teacher_data$feedback_salary <- factor(teacher_data$feedback_salary, levels=c("No positive change", "A small change", "A moderate change", "A large change"), ordered=TRUE)

teacher_data$collab <- factor(teacher_data$collab, levels=c("Strongly disagree", "Disagree", "Agree", "Strongly agree"))
```

### Main Questions:
(1) Which variables and classroom factors are the best predictors of teacher job satisfaction?
(2) How do teacher satisfaction, as well as some of the significant predictors found from question 1, vary by country?

### Introduction

### Data
#### Initial Plots Describing Data

First, we look at a plot of age vs years teacher.
```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=gender)) + geom_point(alpha=0.5,shape=".") + geom_abline(intercept =0, slope=1) +  geom_jitter(alpha=0.5,shape=".")
```

Right away, we can see that there are a number of outliers who appear to have been teaching longer than they've been alive. These are the points above the black line, which represents y=x.

```{r}
teacher_data$age_start <- teacher_data$age - teacher_data$years_teacher
sum(na.omit(teacher_data$age_start) <= 0)
```

Although it doesn't really make sense for people to have started working as a teacher at age 5 either. Let's take a look at how many respondents said they started teaching before age 15 and 21. 
```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=gender)) + geom_point(alpha= 0.5, shape=".") + geom_abline(intercept = -15, slope=1) + geom_abline(intercept = -21, slope=1) 
```

```{r}
sum(na.omit(teacher_data$age_start) <= 15)
```

```{r}
teacher_data %>% ggplot(aes(x=age, y=years_teacher, color=country)) + geom_point(alpha= 0.5, shape=".") + geom_smooth(method="lm", se=F)
```

### Analysis
#### Linear Regression Analysis
```{r}
sat_indices <- grep("sat", names(teacher_data))
m1 <- lm(sat_avg ~ ., data=teacher_data[,-c(13:23)])
summary(m1)
```

#### One-way Anova Tests
##### Does Feedback Influence Salary Increases?
```{r}
m2 <- lm(sat_avg ~ feedback_salary, data=teacher_data)
anova(m2)
boxplot(TT2G46_avg ~ country, data=teacher_data)
teacher_data$subject_count <- rowSums(teacher_data[,24:35], na.rm=TRUE)
```

##### Total Time
```{r}
m3 <- lm(sat_avg ~ total_time, data=teacher_data)
anova(m3)
plot(teacher_data$sat_avg ~ teacher_data$total_time)
abline(m3)

Using stepwise regression
```{r}
# remove SAT questions, since they obviously explain our predictor variable, and then remove NAs for stepwise regression
x <- na.omit(teacher_data[, -grep("sat", colnames(teacher_data))])
m.full <- lm(TT2G46_avg ~., data=x)
m.empty <- lm(TT2G46_avg ~ 1, data=x)
```
Forward, backwards, and both
```{r}
m.forward <- step(m.empty, scope=list(upper=m.full),
                  data=x, direction="forward", trace=FALSE)
m.backward <- step(m.full, scope=list(lower=m.empty),
                  data=x, direction="backward", trace=FALSE)
m.both <- step(m.empty, scope=list(upper=m.full),
                  data=x, direction="both", trace=FALSE)
```



